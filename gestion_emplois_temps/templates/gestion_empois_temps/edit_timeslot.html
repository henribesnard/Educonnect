{% extends 'base.html' %}

{% block content %}
    <h2>Modifier l'emploi du temps</h2>
    <form method="post">
        {% csrf_token %}
        <label for="{{ form.schoolclass.auto_id }}">Classe :</label>
        {{ form.schoolclass }}
        <label for="{{ form.course.auto_id }}">Cours :</label>
        {{ form.course }}
        <label for="{{ form.room.auto_id }}">Salle :</label>
        {{ form.room }}
        <label for="{{ form.start_datetime.auto_id }}">Date de d√©but :</label>
        {{ form.start_datetime }}
        <label for="{{ form.end_datetime.auto_id }}">Date de fin :</label>
        {{ form.end_datetime }}
        <button type="submit">Modifier</button>
    </form>

    {% load static %}
    <script src="{% static 'path/to/jquery.min.js' %}"></script>
    <script>
    $(document).ready(function() {
        function updateAvailableRooms() {
            const startDatetime = $('#{{ form.start_datetime.auto_id }}').val();
            const endDatetime = $('#{{ form.end_datetime.auto_id }}').val();
            const schoolclassId = $('#{{ form.schoolclass.auto_id }}').val();

            if (startDatetime && endDatetime && schoolclassId) {
                $.ajax({
                    url: "{% url 'get_available_rooms' %}",
                    data: {
                        'start_datetime': startDatetime,
                        'end_datetime': endDatetime,
                        'schoolclass_id': schoolclassId
                    },
                    dataType: 'json',
                    success: function (data) {
                        const roomSelect = $('#{{ form.room.auto_id }}');
                        roomSelect.empty();
                        $.each(data, function (index, room) {
                            roomSelect.append($('<option>', {
                                value: room.id,
                                text: room.name
                            }));
                        });
                    }
                });
            }
        }

        $('#{{ form.start_datetime.auto_id }}').change(updateAvailableRooms);
        $('#{{ form.end_datetime.auto_id }}').change(updateAvailableRooms);
        $('#{{ form.schoolclass.auto_id }}').change(updateAvailableRooms);
    });
    </script>
{% endblock %}
