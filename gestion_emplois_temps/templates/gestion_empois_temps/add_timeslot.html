{% extends 'base.html' %}
{% load static %}

{% block content %}
    <h2>Ajouter un emploi du temps</h2>
    <form method="post">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit">Ajouter</button>
    </form>
{% endblock %}

{% block extra_js %}
    <script>
        // Sélectionnez les éléments de formulaire pertinents
        const startDatetimeInput = document.querySelector("#id_start_datetime");
        const endDatetimeInput = document.querySelector("#id_end_datetime");
        const schoolclassInput = document.querySelector("#id_schoolclass");
        const roomSelect = document.querySelector("#id_room");

        function updateRooms() {
            // Récupérez les valeurs des champs de formulaire
            const startDatetime = startDatetimeInput.value;
            const endDatetime = endDatetimeInput.value;
            const schoolclassId = schoolclassInput.value;

            // Vérifiez que les valeurs sont présentes
            if (startDatetime && endDatetime && schoolclassId) {
                // Envoyez une requête AJAX pour récupérer les salles disponibles
                fetch(`/get_available_rooms?start_datetime=${startDatetime}&end_datetime=${endDatetime}&schoolclass_id=${schoolclassId}`)
                    .then(response => response.json())
                    .then(rooms => {
                        // Mettez à jour la liste déroulante des salles avec les salles disponibles
                        roomSelect.innerHTML = "";
                        rooms.forEach(room => {
                            const option = document.createElement("option");
                            option.value = room.id;
                            option.textContent = room.name;
                            roomSelect.appendChild(option);
                        });
                    });
            }
        }

        // Ajoutez des écouteurs d'événements pour mettre à jour les salles lorsque les dates ou la classe sont modifiées
        startDatetimeInput.addEventListener("change", updateRooms);
        endDatetimeInput.addEventListener("change", updateRooms);
        schoolclassInput.addEventListener("change", updateRooms);
    </script>
{% endblock %}
